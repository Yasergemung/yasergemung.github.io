<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
  // ------------------- تهيئة Google OAuth مرة واحدة -------------------
  let googleInitialized = false;
  window.onload = () => {
    google.accounts.id.initialize({
      client_id: "891455424218-lgrnlsb7tivgotdpdas9b5hft9kct3lv.apps.googleusercontent.com",
      callback: handleCredentialResponse
    });
    googleInitialized = true;
  };

  // ------------------- تسجيل دخول Google -------------------
  function googleLogin() {
    if(!googleInitialized){
      alert("جاري تهيئة Google، حاول مرة ثانية بعد قليل");
      return;
    }
    google.accounts.id.prompt(); // يظهر نافذة تسجيل الدخول
  }

  function handleCredentialResponse(response){
    const base64Url = response.credential.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c){
      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));

    const user = JSON.parse(jsonPayload);

    localStorage.setItem('user', JSON.stringify(user));
    localStorage.setItem('role','user');

    alert("تم تسجيل الدخول بجوجل بنجاح ✅");
    window.location = "index.html";
  }

  // ------------------- تسجيل دخول تقليدي -------------------
  function login(){
    let user = document.getElementById("user").value;
    let pass = document.getElementById("pass").value;

    if(user==="yasser" && pass==="1234"){
      localStorage.setItem("role","admin");
      window.location="dashboard.html";
      return;
    }

    if(user && pass){
      localStorage.setItem("role","user");
      localStorage.setItem("user", JSON.stringify({name:user,picture:""}));
      window.location="index.html";
    }
  }
</script>
